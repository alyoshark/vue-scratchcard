(function(o,f){typeof exports=="object"&&typeof module<"u"?module.exports=f(require("vue")):typeof define=="function"&&define.amd?define(["vue"],f):(o=typeof globalThis<"u"?globalThis:o||self,o["vue-scratchcard"]=f(o.Vue))})(this,function(o){"use strict";const f=(e,t,c,s)=>{const a=e.getImageData(0,0,t,c),i=a.data.length/s;let l=0;for(let r=0;r<a.data.length;r+=s)Number(a.data[r])===0&&l++;return Math.round(l/i*100)},w=(e,t)=>{const{left:c,top:s}=e.getBoundingClientRect(),a=t.touches&&t.touches[0];if(a)return{x:a.clientX-c,y:a.clientY-s};const i=window.pageYOffset||document.documentElement.scrollTop,l=window.pageXOffset||document.documentElement.scrollLeft;return{x:t.pageX-c-l,y:t.pageY-s-i}},I=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),O=(e,t)=>Math.atan2(t.x-e.x,t.y-e.y),P=(e,t,c)=>{const{x:s,y:a}=t;if(c)return e.drawImage(c,s-c.width/2,a-c.height/2);e.beginPath(),e.arc(s,a,25,0,2*Math.PI,!1),e.fill()},B=(e,t,c,s)=>{const a=I(t,c),i=O(t,c);let{x:l,y:r}=t;for(let u=0;u<a;u++)l=t.x+Math.sin(i)*u,r=t.y+Math.cos(i)*u,e.globalCompositeOperation="destination-out",P(e,{x:l,y:r},s)},g=e=>Object.keys(e).map(t=>`${t}:${e[t]}`).concat(";"),x={position:"absolute",width:"100%",height:"100%",display:"block"},C=document.createElement("canvas"),E=C.getContext("2d"),H=o.defineComponent({emits:["complete"],props:{imageUrl:{type:String,required:!0},cardWidth:{type:Number,required:!0},cardHeight:{type:Number,required:!0},finishPercent:{type:Number,required:!0},forceReveal:{type:Boolean,default:!1},brushUrl:String},setup(e,{slots:t,emit:c}){const s=o.computed(()=>({position:"relative",display:"block",width:`${e.cardWidth}px`,height:`${e.cardHeight}px`})),a=o.ref(!1),i=o.ref(!1),l=o.ref(!1),r=o.ref(C),u=o.ref(E),y=o.ref({x:0,y:0}),m=new Image;m.crossOrigin="Anonymous",m.src=e.imageUrl;const L=()=>{var n;(n=u.value)==null||n.drawImage(m,0,0,e.cardWidth,e.cardHeight),a.value=!0},v=new Image;e.brushUrl&&(v.crossOrigin="Anonymous",v.src=e.brushUrl);const p=()=>{var d;const n=r.value;l.value||((d=n==null?void 0:n.parentNode)==null||d.removeChild(n),c("complete")),l.value=!0},b=n=>{i.value=!0,y.value=w(r.value,n)},M=()=>{i.value=!1},T=n=>{if(!i.value)return;n.preventDefault();const d=w(r.value,n),q=y.value,h=u.value;if(!h)return;B(h,q,d,v),y.value=d,f(h,e.cardWidth,e.cardHeight,32)>e.finishPercent&&p()};return o.onMounted(()=>{var d;const n=(d=r.value)==null?void 0:d.getContext("2d");if(!n)throw Error(`can't start a CanvasRenderingContext2D from ${r.value}`);u.value=n,m.onload=L}),o.watch(()=>e.forceReveal,n=>n&&p()),()=>{const n=t.default;if(!n)throw Error("please pass a default content slot");const d=o.h("div",{style:g(x)},n()),h=[o.h("canvas",{style:g(x),onMousedown:b,onMousemove:T,onMouseup:M,onTouchstart:b,onTouchmove:T,onTouchend:M,width:e.cardWidth,height:e.cardHeight,ref:r})];return a.value&&h.unshift(d),o.h("div",{style:g(s.value)},h)}}});return{install(e){e.component("vue-scratchcard",H)}}});
